from gtts import gTTS
import pyaudio
import io
import wave
from gtts.lang import tts_langs
while True:
# VÄƒn báº£n cáº§n Ä‘á»c
    text = input("Nháº­p vÄƒn báº£n mÃ  báº¡n muá»‘n chuyá»ƒn Ä‘á»•i:")

    langs = tts_langs()
    print(f"| {'MÃ£':<6} | {'NgÃ´n ngá»¯':<30} |")
    print("|" + "-"*6 + "|" + "-"*32 + "|")
    for code, language in langs.items():
        print(f"| {code:<6} | {language:<30} |")
    lang = input("Chá»n ngÃ´n ngá»¯:")
    print(" Ã‚m thanh sau khi chuyá»ƒn Ä‘á»•i: ")
# Chuyá»ƒn vÄƒn báº£n thÃ nh Ã¢m thanh (gTTS tráº£ vá» file mp3)
    tts = gTTS(text=text, lang='vi')
    
# LÆ°u vÃ o bá»™ nhá»› RAM thay vÃ¬ lÆ°u file
    mp3_fp = io.BytesIO()
    tts.write_to_fp(mp3_fp)
    mp3_fp.seek(0)

# Báº¡n cáº§n chuyá»ƒn tá»« mp3 -> wav Ä‘á»ƒ PyAudio Ä‘á»c Ä‘Æ°á»£c
    from pydub import AudioSegment
    audio = AudioSegment.from_file(mp3_fp, format="mp3")

# Chuyá»ƒn audio thÃ nh dáº¡ng raw data
    raw_data = io.BytesIO()
    audio.export(raw_data, format="wav")
    raw_data.seek(0)

# Äá»c file wav Ä‘á»ƒ láº¥y params cho PyAudio
    wf = wave.open(raw_data, 'rb')

# Khá»Ÿi táº¡o PyAudio
    p = pyaudio.PyAudio()

# Má»Ÿ luá»“ng Ã¢m thanh
    stream = p.open(format=p.get_format_from_width(wf.getsampwidth()),
                    channels=wf.getnchannels(),
                    rate=wf.getframerate(),
                    output=True)

# Äá»c vÃ  phÃ¡t Ã¢m thanh
    chunk = 1024
    data = wf.readframes(chunk)
    while data:
        stream.write(data)
        data = wf.readframes(chunk)

# Dá»n dáº¹p
    stream.stop_stream()
    stream.close()
    p.terminate()

#ğŸ“Œ Giáº£i thÃ­ch nhanh:
# gTTS sinh ra file mp3.

# DÃ¹ng pydub Ä‘á»ƒ chuyá»ƒn mp3 thÃ nh wav trong bá»™ nhá»› RAM (khÃ´ng cáº§n lÆ°u file).

# PyAudio phÃ¡t trá»±c tiáº¿p dÃ²ng dá»¯ liá»‡u tá»« file wav Ä‘Ã³.

# ThÆ° viá»‡n cáº§n :
# gTTS : pip install gTTS
# Pyaudio : pip install PyAudio
# Pydub: pip install pydub

## 1. ffmpeg: https://www.gyan.dev/ffmpeg/builds/ ( Tai ffmpeg-release-essentials.zip ) -> Giáº£i nÃ©n
## Sau khi cÃ i Ä‘áº·t -> thÃªm ffmpeg vÃ o path :
## 2. ThÃªm ffmpeg vÃ o há»‡ thá»‘ng PATH (Windows):
# Copy Ä‘Æ°á»ng dáº«n tá»›i thÆ° má»¥c bin (vÃ­ dá»¥: C:\ffmpeg\bin).
# Báº¥m Start Menu â†’ TÃ¬m Environment Variables â†’ Báº¥m Edit the system environment variables.
# Chá»n Environment Variables.
# á» pháº§n System variables, chá»n Path â†’ Edit â†’ New â†’ DÃ¡n Ä‘Æ°á»ng dáº«n = Ä‘Æ°á»ng dáº«n Ä‘áº¿n file bin cá»§a ffmpeg trÃªn mÃ¡y báº¡n Ä‘á»ƒ nÃ³ Ä‘á»c cáº£ 3 file .exe VD: C:\ffmpeg\bin
# áº¤n OK háº¿t.

# Cáº­p nháº­t PATH cho mÃ´i trÆ°á»ng Anaconda:
# Má»Ÿ Anaconda Prompt vÃ  gÃµ lá»‡nh: conda install ffmpeg
# Sau Ä‘Ã³, báº¡n cÃ³ thá»ƒ kiá»ƒm tra láº¡i báº±ng lá»‡nh: conda list ffmpeg
# ThÃªm Ä‘Æ°á»ng dáº«n vÃ o PATH trong Anaconda: set PATH= Ä‘Æ°á»ng dáº«n Ä‘áº¿n file bin cá»§a ffmpeg Ä‘á»ƒ nÃ³ Ä‘á»c cáº£ 3 file .exe (VÃ­ dá»¥ C:\ffmpeg\bin).
